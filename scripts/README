# Buffett Focus - Enhanced Stock Network Analyzer

A sophisticated D3.js-powered visualization tool that analyzes stocks using Warren Buffett's investment criteria and displays them as an interactive force-directed network graph.

## ðŸŽ¯ Key Improvements

### 1. **Comprehensive Buffett Metrics** (Old School Value Reference)
All metrics from the Old School Value article are now included:

#### Profitability Metrics:
- âœ… **Gross Margin** (>40% ideal)
- âœ… **Net Margin** (>15% ideal)
- âœ… **Operating Margin**
- âœ… **SG&A Ratio** (<30% ideal - "Companies with low SG&A have moats")

#### Return Metrics:
- âœ… **ROE** (Return on Equity - >15% ideal)
- âœ… **ROA** (Return on Assets - >7% ideal)
- âœ… **ROIC** (Return on Invested Capital - >12% ideal)

#### Debt & Liquidity:
- âœ… **Debt-to-Equity** (<0.5 ideal)
- âœ… **Current Ratio** (>1.5 ideal)
- âœ… **Interest Coverage**

#### Cash Flow Quality:
- âœ… **Free Cash Flow Margin** (>15% ideal)
- âœ… **CapEx Ratio** (<5% ideal)

#### Additional:
- âœ… **Retained Earnings** (long-term profitability indicator)
- âœ… **P/E Ratio** and **P/B Ratio** (valuation)

### 2. **5-Year Historical Data Visualization**
- **Mini Histograms**: When you click on a stock bubble, you now see 5-year trend charts for:
  - Gross Margin
  - Net Margin
  - ROE
  - Debt-to-Equity
- **Trend Indicators**: Up/down arrows show direction
- **Visual Consistency**: Color-coded bars showing metric evolution

### 3. **Improved Graph Layout**
- **Industry Color Coding**: Each sector has a distinct color:
  - ðŸ”µ Technology (Cyan)
  - ðŸ”´ Communication Services (Pink)
  - ðŸŸ  Consumer Discretionary (Orange)
  - ðŸŸ¢ Consumer Staples (Green)
  - ðŸŸ¡ Financials (Gold)
  - ðŸ”´ Healthcare (Magenta)
  - ðŸ”µ Industrials (Royal Blue)
  - ðŸ”´ Energy (Crimson)
- **Tighter Clustering**: Reduced force distances (80 vs 100)
- **Stronger Repulsion**: Better node separation (-250 vs -300)
- **Collision Detection**: Prevents node overlap
- **Smart Labels**: Only shows tickers for high-scoring stocks (>60) to reduce clutter

### 4. **Compact Metrics Display**
- **2-Column Grid Layout**: No more scrolling needed
- **Smaller Cards**: 8px padding instead of 12px
- **Visual Comparison Bars**: Each metric shows:
  - Current value vs. ideal target
  - Industry average (white marker)
  - Color-coded performance (green/yellow/red)
- **Radar Chart**: Pentagon visualization of 5 key pillars
- **Score Badge**: Large, prominent score in top-right

## ðŸ“ Project Structure

```
buffett-focus/
â”œâ”€â”€ get_data_improved.py    # Enhanced data fetching with all Buffett metrics
â”œâ”€â”€ index.html              # Main visualization interface
â”œâ”€â”€ js/
â”‚   â””â”€â”€ graph.js           # D3.js force-directed graph logic
â”œâ”€â”€ data/
â”‚   â””â”€â”€ graph_data.json    # Generated stock data (after running script)
â”œâ”€â”€ requirements.txt        # Python dependencies
â””â”€â”€ README.md              # This file
```

## ðŸš€ Setup & Installation

### 1. Install Dependencies
```bash
pip install -r requirements.txt
```

### 2. Generate Data
```bash
python get_data_improved.py
```

This will:
- Fetch S&P 500 and DAX stocks
- Calculate comprehensive Buffett metrics
- Build correlation network
- Save to `data/graph_data.json`

**Note**: Full run (500+ stocks) takes ~15-20 minutes. The script is currently set to 100 stocks for testing.

### 3. Serve the Visualization
```bash
# Option 1: Python
python -m http.server 8000

# Option 2: Node.js
npx serve

# Option 3: VS Code Live Server extension
```

### 4. Open in Browser
Navigate to: `http://localhost:8000`

## ðŸŽ® How to Use

### Navigation:
- **Click & Drag**: Move nodes around
- **Mouse Wheel**: Zoom in/out
- **Click Node**: View detailed analysis
- **Search Bar**: Type ticker to jump to stock

### Controls:
- **+ Button**: Zoom in
- **âˆ’ Button**: Zoom out
- **âŸ² Button**: Reset view and deselect

### Reading the Graph:
- **Node Size**: Market capitalization
- **Node Color**: Industry (brighter = higher score)
- **Lines**: Price correlation (thicker = stronger)

### Score Interpretation:
- **70-100** (Green): Wide Moat - Buffett would likely approve
- **40-69** (Yellow): Narrow Moat - Investigate further
- **0-39** (Red): No Moat - Probably not a Buffett stock

## ðŸ“Š Data Sources

- **Stock Data**: Yahoo Finance (via yfinance)
- **S&P 500 List**: Wikipedia
- **DAX List**: Wikipedia
- **Metrics Formula**: Based on Old School Value's Buffett analysis

## ðŸ”§ Customization

### Adjust Stock Universe:
Edit line 56-57 in `get_data_improved.py`:
```python
# Current: Top 80 S&P 500 + Top 20 DAX
tickers = sp500[:80] + dax[:20]

# Full run:
tickers = sp500 + dax
```

### Modify Scoring Weights:
Edit lines 128-142 in `get_data_improved.py` to adjust what matters most:
```python
# Example: Weight margins more heavily
if metrics['gross_margin'] > 40: score += 15  # was 10
```

### Change Correlation Threshold:
Edit line 238 in `get_data_improved.py`:
```python
threshold = 0.70  # Lower = more connections
```

## ðŸ› Troubleshooting

### "No data found" error:
- Check internet connection (scrapes Wikipedia)
- Some tickers may be delisted - script skips them automatically

### Graph too slow:
- Reduce number of stocks in `get_data_improved.py`
- Increase correlation threshold to reduce links

### Missing metrics:
- Some companies don't report all metrics
- Script uses 0 as fallback, affecting score

## ðŸ“ˆ Performance Tips

1. **Cache Data**: The JSON file is static until you re-run the script
2. **Limit Stocks**: 50-100 stocks is optimal for performance
3. **Filter by Score**: Focus on stocks with score >50 for quality

## ðŸŽ“ Understanding the Metrics

### What Buffett Looks For:
1. **High Margins** = Pricing Power
2. **Low SG&A** = Operational Efficiency  
3. **High ROE/ROIC** = Excellent Capital Allocation
4. **Low Debt** = Financial Stability
5. **Strong FCF** = Real Cash Generation
6. **Consistency** = Predictable Business

### Red Flags:
- Gross margin <20%
- Debt/Equity >2.0
- Negative FCF
- ROE <10%
- Declining margins over 5 years

## ðŸ“š References

- [Old School Value - How Buffett Interprets Financial Statements](https://www.oldschoolvalue.com/tutorial/this-is-how-buffett-interprets-financial-statements/)
- [Warren Buffett's Investment Philosophy](https://www.berkshirehathaway.com/letters/letters.html)

## ðŸ“ License

MIT License - Feel free to use and modify

## ðŸ¤ Contributing

Improvements welcome! Some ideas:
- Add DCF valuation model
- Include management quality scores
- Compare to Buffett's actual holdings
- Add export to CSV functionality
- Mobile-responsive sidebar

---

**Built with**: Python, D3.js, yfinance, pandas, scikit-learn
**Inspired by**: Warren Buffett's investment philosophy
