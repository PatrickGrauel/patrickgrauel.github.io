<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buffett Focus</title>
    <style>
        :root {
            --bg: #0b0c10; --surface: #15171e; --surface-h: #1e212b;
            --text: #f7f7fa; --muted: #8b949e; --border: rgba(255,255,255,0.1);
            --primary: #0079fd; --success: #00c853; --warning: #ffd700; --danger: #ff3d00;
            --font: -apple-system, BlinkMacSystemFont, sans-serif;
        }
        * { box-sizing: border-box; }
        body { margin: 0; background: var(--bg); color: var(--text); font-family: var(--font); overflow: hidden; height: 100vh; }

        /* GRAPH LAYER - Full viewport */
        #graph-container { 
            position: absolute; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            z-index: 0; 
            background: radial-gradient(circle at center, #15171e 0%, #0b0c10 100%); 
        }
        
        #main-svg {
            width: 100%;
            height: 100%;
            display: block;
        }
        
        /* ZOOM CONTROLS */
        .zoom-controls {
            position: absolute; bottom: 30px; left: 30px; z-index: 20;
            display: flex; flex-direction: column; gap: 8px;
        }
        .zoom-btn {
            width: 36px; height: 36px; background: var(--surface); border: 1px solid var(--border);
            color: var(--text); border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center;
            font-size: 18px; font-weight: bold; transition: 0.2s;
        }
        .zoom-btn:hover { background: var(--surface-h); border-color: var(--primary); }

        /* SIDEBAR HUD */
        #sidebar {
            position: absolute; top: 20px; right: 20px; bottom: 20px; width: 420px;
            background: rgba(21, 23, 30, 0.95); border: 1px solid var(--border); border-radius: 12px;
            backdrop-filter: blur(12px); z-index: 10; display: flex; flex-direction: column;
            box-shadow: -10px 0 30px rgba(0,0,0,0.5); transform: translateX(0); transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        #sidebar.hidden { transform: translateX(110%); }

        /* HEADER */
        .panel-header { padding: 20px; border-bottom: 1px solid var(--border); }
        .search-wrapper { position: relative; }
        #search-input {
            width: 100%; padding: 12px 16px; background: var(--bg); border: 1px solid var(--border);
            color: white; border-radius: 8px; outline: none; font-size: 14px;
        }
        #search-input:focus { border-color: var(--primary); }

        /* CONTENT */
        .panel-content { flex: 1; overflow-y: auto; padding: 20px; }
        
        /* METRIC CARDS */
        .metric-card {
            background: var(--bg); border: 1px solid var(--border); border-radius: 8px;
            padding: 12px; margin-bottom: 12px; position: relative; overflow: hidden;
        }
        .m-header { display: flex; justify-content: space-between; margin-bottom: 6px; }
        .m-title { font-size: 11px; text-transform: uppercase; color: var(--muted); font-weight: 700; }
        .m-value { font-size: 16px; font-weight: 700; color: var(--text); }
        
        /* COMPARISON BAR */
        .comp-bar-container {
            height: 4px; background: #333; border-radius: 2px; margin-top: 8px; position: relative;
        }
        .comp-bar { height: 100%; border-radius: 2px; position: absolute; left: 0; top: 0; }
        .comp-marker {
            position: absolute; top: -3px; width: 2px; height: 10px; background: #fff; z-index: 2;
        }
        .comp-label {
            display: flex; justify-content: space-between; font-size: 10px; color: var(--muted); margin-top: 4px;
        }

        /* RADAR & HISTOGRAM */
        #radar-container { 
            height: 200px; 
            margin-bottom: 20px; 
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        /* TAGS */
        .tag { font-size: 10px; padding: 2px 6px; border-radius: 4px; background: var(--surface-h); border: 1px solid var(--border); color: var(--muted); }

        /* DETAILS HEADER */
        .stock-header { margin-bottom: 20px; border-bottom: 1px solid var(--border); padding-bottom: 20px; }
        .ticker-row { display: flex; justify-content: space-between; align-items: center; }
        .ticker-lg { font-size: 32px; font-weight: 800; }
        .score-lg { font-size: 24px; font-weight: 800; }
        .score-lg.good { color: var(--success); }
        .score-lg.mid { color: var(--warning); }
        .score-lg.bad { color: var(--danger); }

        /* TOGGLE */
        #toggle-sidebar {
            position: absolute; top: 20px; right: 20px; z-index: 5;
            background: var(--surface); color: var(--text); border: 1px solid var(--border);
            padding: 8px 12px; border-radius: 8px; cursor: pointer; display: none;
        }
        #sidebar.hidden ~ #toggle-sidebar { display: block; }
        
        /* Scrollbar styling */
        .panel-content::-webkit-scrollbar {
            width: 6px;
        }
        .panel-content::-webkit-scrollbar-track {
            background: var(--bg);
        }
        .panel-content::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
        }
    </style>
</head>
<body>

    <div id="graph-container">
        <svg id="main-svg"></svg>
    </div>

    <div class="zoom-controls">
        <div class="zoom-btn" onclick="app.zoomIn()">+</div>
        <div class="zoom-btn" onclick="app.zoomOut()">−</div>
        <div class="zoom-btn" onclick="app.resetZoom()">⟲</div>
    </div>

    <div id="sidebar">
        <div class="panel-header">
            <div class="search-wrapper">
                <input type="text" id="search-input" placeholder="Search Ticker (e.g. AAPL)..." list="tickers">
                <datalist id="tickers"></datalist>
            </div>
        </div>

        <div class="panel-content">
            <div id="state-empty" style="text-align: center; margin-top: 100px; color: var(--muted);">
                <p>Select a company on the map<br>to see Warren Buffett's Checklist.</p>
                <div style="font-size: 12px; margin-top: 20px;">
                    <span style="color:var(--success)">● Wide Moat</span> &nbsp; 
                    <span style="color:var(--warning)">● Narrow</span> &nbsp; 
                    <span style="color:var(--danger)">● None</span>
                </div>
            </div>

            <div id="state-details" style="display: none;">
                <div class="stock-header">
                    <div class="ticker-row">
                        <div>
                            <div class="ticker-lg" id="det-ticker">--</div>
                            <div style="font-size:13px; color:var(--muted)" id="det-name">--</div>
                        </div>
                        <div class="score-lg" id="det-score">--</div>
                    </div>
                    <div style="margin-top:10px; display:flex; gap:5px;">
                        <span class="tag" id="det-sector">--</span>
                        <span class="tag" id="det-industry">--</span>
                    </div>
                </div>

                <div style="font-size:11px; font-weight:700; color:var(--muted); margin-bottom:10px;">MOAT COMPOSITE</div>
                <div id="radar-container"></div>

                <div style="font-size:11px; font-weight:700; color:var(--muted); margin:20px 0 10px 0;">BUFFETT METRICS & BENCHMARKS</div>
                <div id="metrics-list"></div>
            </div>
        </div>
    </div>

    <button id="toggle-sidebar" onclick="app.toggleSidebar()">Open Panel</button>

    <div id="tooltip" style="position: absolute; opacity: 0; pointer-events: none; background: #15171e; padding: 8px 12px; border: 1px solid #333; border-radius: 6px; font-size: 12px; color: #fff; z-index: 100;"></div>

    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="js/graph.js"></script>
</body>
</html>
