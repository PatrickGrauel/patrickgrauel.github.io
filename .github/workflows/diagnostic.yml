name: üîç Diagnostic Test

on:
  workflow_dispatch:

jobs:
  diagnose:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      
      - name: Install dependencies
        run: |
          pip install yfinance pandas numpy
      
      - name: Run diagnostic
        run: |
          python diagnostic.py
      
      - name: Check if data file exists
        run: |
          echo "Checking for graph_data.json..."
          if [ -f data/graph_data.json ]; then
            echo "‚úÖ File exists"
            echo "Size: $(du -h data/graph_data.json)"
            echo ""
            echo "First 50 lines:"
            head -50 data/graph_data.json
            echo ""
            echo "Stock count: $(grep -o '"id"' data/graph_data.json | wc -l)"
          else
            echo "‚ùå File does not exist!"
          fi
      
      - name: Upload diagnostic results
        uses: actions/upload-artifact@v3
        if: always()
        with:
          name: diagnostic-results
          path: |
            data/diagnostic_test.json
            data/graph_data.json
